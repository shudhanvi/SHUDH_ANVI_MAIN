<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Manhole Report</title>
    <script src="https://cdn.jsdelivr.net/npm/vega@5"></script>
    <script src="https://cdn.jsdelivr.net/npm/vega-lite@5"></script>
    <script src="https://cdn.jsdelivr.net/npm/vega-embed@6"></script>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 20px;
            background-color: #f4f4f9;
            color: #333;
        }

        .container {
            max-width: 1200px;
            margin: auto;
            background: #fff;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }

        .header {
            text-align: center;
            border-bottom: 2px solid #eee;
            padding-bottom: 10px;
            margin-bottom: 20px;
        }

        .chart-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(450px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .chart-container {
            background: #f9f9f9;
            padding: 15px;
            border-radius: 6px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
        }

        h1, h2, h3 {
            color: #2c3e50;
        }

        ul {
            list-style-type: none;
            padding: 0;
        }

        li {
            margin-bottom: 10px;
        }

        .map-container {
            text-align: center;
            margin-top: 20px;
        }

            .map-container img {
                max-width: 100%;
                height: auto;
                border: 1px solid #ddd;
                border-radius: 6px;
            }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>Manhole Report</h1>
            <p>High-level analytics of the entire manhole network, a detailed manhole report, and a new predictive analysis section.</p>
        </div>

        <h2>Detailed Manhole Report for MH-0005</h2>
        <p>This section provides a detailed analysis of the operational history and characteristics for a randomly selected manhole to demonstrate granular data insights.</p>

        <h3>Manhole Characteristics</h3>
        <ul>
            <li><strong>Nearest Land Use:</strong> Industrial</li>
        </ul>

        <h3>Operational History & Condition</h3>
        <ul>
            <li><strong>History of Clogging Incidents:</strong> 1</li>
            <li><strong>Last Cleaned Date:</strong> 22-05-2023</li>
            <li><strong>Total Number of Cleaning Operations:</strong> 4</li>
        </ul>

        <h3>Performance Metrics from Cleaning Operations</h3>
        <ul>
            <li><strong>Total Waste Collected:</strong> 19 kg</li>
            <li><strong>Average Operation Time:</strong> 20.50 minutes</li>
            <li><strong>Most Frequent Blockage Level:</strong> high</li>
            <li><strong>Most Used Robot:</strong> sb_003</li>
        </ul>

        <h3>Average Gas Readings</h3>
        <p>Based on the recorded operational data, the average gas levels were:</p>
        <ul>
            <li><strong>Average Gas Data:</strong> CO: 1.38, CH4: 50.12, H2S: 7.93</li>
        </ul>

        <div class="map-container">
            <h3>Manhole Location Map</h3>
            <img src="manhole-report.jpeg" alt="Manhole Report Map">
        </div>

        <h2>High-Level Ward Analytics</h2>
        <div class="chart-grid">
            <div class="chart-container">
                <h3>Manhole Condition Distribution</h3>
                <div id="manhole_condition_chart_container"></div>
            </div>
            <div class="chart-container">
                <h3>Junction Type Distribution</h3>
                <div id="junction_type_chart_container"></div>
            </div>
        </div>
        <div class="chart-grid">
            <div class="chart-container">
                <h3>Clogging Incidents by Junction Type</h3>
                <div id="clogging_by_junction_chart_container"></div>
            </div>
            <div class="chart-container">
                <h3>Average Waste Collected by Blockage Level</h3>
                <div id="avg_waste_by_blockage_level_container"></div>
            </div>
        </div>
        <div class="chart-grid">
            <div class="chart-container">
                <h3>Sewer Length by Area Type</h3>
                <div id="sewer_length_chart_container"></div>
            </div>
        </div>


        <h2>Predictive Analysis</h2>
        <p>Based on historical data for MH-0005, here are some predictive insights:</p>
        <h3>Nearest Manholes</h3>
        <ul>
            <li><strong>MH-0006:</strong> 0.23 km away</li>
            <li><strong>MH-0004:</strong> 0.35 km away</li>
            <li><strong>MH-0007:</strong> 0.41 km away</li>
        </ul>
        <h3>Clogging and Cleaning Prediction</h3>
        <ul>
            <li><strong>Estimated Cleaning Frequency:</strong> The manhole requires cleaning approximately every <strong>45 days</strong>.</li>
            <li><strong>Predicted Next Cleaning Date:</strong> The next cleaning is estimated to be needed around <strong>06-07-2023</strong>.</li>
            <li><strong>Robo Availability:</strong> A robo should be scheduled to be available at least <strong>5 days</strong> before the predicted cleaning date to account for potential delays.</li>
        </ul>
    </div>

    <script>
        // Vega-Lite chart specs (manhole_condition_chart.json)
        vegaEmbed('#manhole_condition_chart_container', {
            "$schema": "https://vega.github.io/schema/vega-lite/v4.17.0.json",
            "title": "Manhole Condition Distribution",
            "width": 500,
            "datasets": { "data-52ea87b58e569efc980c3167e83c1384": [{ "Condition": "Fair", "Count": 20 }, { "Condition": "Good", "Count": 18 }, { "Condition": "Poor", "Count": 12 }] },
            "layer": [
                {
                    "mark": { "type": "arc", "outerRadius": 120 },
                    "encoding": {
                        "color": { "field": "Condition", "legend": { "title": "Manhole Condition" }, "sort": { "field": "Count", "order": "descending" }, "type": "nominal" },
                        "order": { "field": "Count", "sort": "descending", "type": "quantitative" },
                        "theta": { "field": "Count", "stack": true, "type": "quantitative" },
                        "tooltip": [{ "field": "Condition", "type": "nominal" }, { "field": "Count", "type": "quantitative" }]
                    }
                },
                {
                    "mark": { "type": "text", "radius": 140 },
                    "encoding": {
                        "color": { "value": "black" },
                        "order": { "field": "Count", "sort": "descending", "type": "quantitative" },
                        "text": { "field": "Condition", "type": "nominal" },
                        "theta": { "field": "Count", "stack": true, "type": "quantitative" },
                        "tooltip": [{ "field": "Condition", "type": "nominal" }, { "field": "Count", "type": "quantitative" }]
                    }
                }
            ],
            "data": { "name": "data-52ea87b58e569efc980c3167e83c1384" }
        });

        // Vega-Lite chart specs (junction_type_chart.json)
        vegaEmbed('#junction_type_chart_container', {
            "$schema": "https://vega.github.io/schema/vega-lite/v4.17.0.json",
            "title": "Junction Type Distribution",
            "width": 500,
            "datasets": { "data-427dda10257459e3942c72fe2d60cf8d": [{ "Junction Type": "Bend", "Count": 12 }, { "Junction Type": "Y-Junction", "Count": 10 }, { "Junction Type": "Straight", "Count": 9 }, { "Junction Type": "Multi-Inlet", "Count": 9 }, { "Junction Type": "Cross-Junction", "Count": 8 }] },
            "layer": [
                {
                    "mark": { "type": "arc", "outerRadius": 120 },
                    "encoding": {
                        "color": { "field": "Junction Type", "legend": { "title": "Junction Type" }, "sort": { "field": "Count", "order": "descending" }, "type": "nominal" },
                        "order": { "field": "Count", "sort": "descending", "type": "quantitative" },
                        "theta": { "field": "Count", "stack": true, "type": "quantitative" },
                        "tooltip": [{ "field": "Junction Type", "type": "nominal" }, { "field": "Count", "type": "quantitative" }]
                    }
                },
                {
                    "mark": { "type": "text", "radius": 140 },
                    "encoding": {
                        "color": { "value": "black" },
                        "order": { "field": "Count", "sort": "descending", "type": "quantitative" },
                        "text": { "field": "Junction Type", "type": "nominal" },
                        "theta": { "field": "Count", "stack": true, "type": "quantitative" },
                        "tooltip": [{ "field": "Junction Type", "type": "nominal" }, { "field": "Count", "type": "quantitative" }]
                    }
                }
            ],
            "data": { "name": "data-427dda10257459e3942c72fe2d60cf8d" }
        });

        // Vega-Lite chart specs (clogging_by_junction_chart.json)
        vegaEmbed('#clogging_by_junction_chart_container', {
            "$schema": "https://vega.github.io/schema/vega-lite/v4.17.0.json",
            "datasets": { "data-e2234dbce1acfd4e43f497ad03981b13": [{ "Junction Type": "Bend", "Total Clogging Incidents": 59 }, { "Junction Type": "Cross-Junction", "Total Clogging Incidents": 33 }, { "Junction Type": "Multi-Inlet", "Total Clogging Incidents": 41 }, { "Junction Type": "Straight", "Total Clogging Incidents": 42 }, { "Junction Type": "Y-Junction", "Total Clogging Incidents": 50 }] },
            "data": { "name": "data-e2234dbce1acfd4e43f497ad03981b13" },
            "mark": "bar",
            "encoding": {
                "tooltip": [{ "field": "Junction Type", "type": "nominal" }, { "field": "Total Clogging Incidents", "type": "quantitative" }],
                "x": { "field": "Junction Type", "sort": "-y", "type": "nominal" },
                "y": { "field": "Total Clogging Incidents", "type": "quantitative" }
            },
            "width": 500,
            "title": "Clogging Incidents by Junction Type"
        });

        // Vega-Lite chart specs (avg_waste_by_blockage_level.json)
        vegaEmbed('#avg_waste_by_blockage_level_container', {
            "$schema": "https://vega.github.io/schema/vega-lite/v4.17.0.json",
            "datasets": { "data-6988db76dc165c55a9a244a74b27ad0c": [{ "Blockage Level": "high", "Average Waste Collected (kg)": 5.765217391304348 }, { "Blockage Level": "low", "Average Waste Collected (kg)": 5.815789473684211 }, { "Blockage Level": "medium", "Average Waste Collected (kg)": 6.333333333333333 }] },
            "data": { "name": "data-6988db76dc165c55a9a244a74b27ad0c" },
            "mark": "bar",
            "encoding": {
                "tooltip": [{ "field": "Blockage Level", "type": "nominal" }, { "field": "Average Waste Collected (kg)", "type": "quantitative" }],
                "x": { "field": "Blockage Level", "sort": "-y", "type": "nominal" },
                "y": { "field": "Average Waste Collected (kg)", "type": "quantitative" }
            },
            "width": 500,
            "title": "Average Waste Collected by Blockage Level"
        });

        // Vega-Lite chart specs (sewer_length_chart.json)
        vegaEmbed('#sewer_length_chart_container', {
            "$schema": "https://vega.github.io/schema/vega-lite/v4.17.0.json",
            "datasets": { "data-fa4ac64866a097de7c0f85eb1e114954": [{ "Area Type": "Residential", "Sewer Length (km)": 24.77 }, { "Area Type": "Slum", "Sewer Length (km)": 30.42 }, { "Area Type": "Waterbody", "Sewer Length (km)": 16.23 }] },
            "data": { "name": "data-fa4ac64866a097de7c0f85eb1e114954" },
            "mark": "bar",
            "encoding": {
                "tooltip": [{ "field": "Area Type", "type": "nominal" }, { "field": "Sewer Length (km)", "type": "quantitative" }],
                "x": { "field": "Area Type", "type": "nominal" },
                "y": { "field": "Sewer Length (km)", "type": "quantitative" }
            },
            "width": 500,
            "title": "Sewer Length by Area Type"
        });
    </script>
</body>
</html>
